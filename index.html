<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Crypto Scalp Margin Calculator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body {
      font-family: Poppins, system-ui;
      background: #0b1220;
      color: #e6eef8;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .card {
      background: #0f1724;
      padding: 30px 35px;
      border-radius: 18px;
      max-width: 600px;
      width: 90%;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    }
    h3 {
      text-align: center;
      margin-top: 0;
      color: #f97316;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 8px;
      border: 1px solid #263044;
      background: #061221;
      color: #e6eef8;
      font-size: 15px;
    }
    button {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: #f97316;
      color: #071322;
      font-weight: 700;
      margin-top: 10px;
      transition: background .2s;
      font-size: 15px;
    }
    button:hover { background: #fb923c; }
    .out {
      margin-top: 15px;
      padding: 12px;
      border-radius: 8px;
      background: #081426;
      color: #cfe9ff;
      font-size: 15px;
      line-height: 1.6em;
    }
    b {
      color: #fbbf24; /* highlight important values */
    }
    .tp-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
    }
    .tp-row label {
      flex: 1;
      text-align: left;
    }
    #tpToggle {
      width: auto;
      margin: 0;
    }
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      .card {
        padding: 20px;
        border-radius: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <h3>Crypto Scalp Margin Calculator</h3>

    <label>Risk Type</label>
    <select id="riskType" onchange="toggleMode()">
      <option value="fixed">Fixed ($)</option>
      <option value="percent">% of Capital</option>
    </select>

    <div id="capitalWrapper" style="display:none">
      <label>Total Capital (USDT)</label>
      <input id="capital" type="number" step="any" placeholder="e.g. 100">
    </div>

    <label id="riskLabel">Risk ($)</label>
    <input id="riskValue" type="number" step="any" placeholder="e.g. 2">

    <label>Entry Price</label>
    <input id="entry" type="number" step="any" placeholder="e.g. 30000">

    <label>Stop Loss Price</label>
    <input id="stop" type="number" step="any" placeholder="e.g. 29990">

    <div class="tp-row">
      <input type="checkbox" id="tpToggle" onchange="toggleTakeProfit()">
      <label for="tpToggle">Enable Take Profit</label>
    </div>
    <input id="takeProfit" type="number" step="any" placeholder="e.g. 30200" disabled>

    <label>Leverage (x)</label>
    <input id="leverage" type="number" step="any" value="100">

    <button onclick="calc()">Calculate</button>
    <button style="background:#334155;color:#fff;" onclick="eraseAll()">Erase All</button>

    <div class="out" id="out">Enter values and press Calculate</div>
  </div>

  <script>
    function toggleMode(){
      const riskType = document.getElementById('riskType').value;
      const capWrapper = document.getElementById('capitalWrapper');
      const riskLabel = document.getElementById('riskLabel');
      const riskInput = document.getElementById('riskValue');
      if(riskType === 'percent'){
        capWrapper.style.display = 'block';
        riskLabel.innerText = 'Risk (%)';
        riskInput.placeholder = 'e.g. 1';
      } else {
        capWrapper.style.display = 'none';
        riskLabel.innerText = 'Risk ($)';
        riskInput.placeholder = 'e.g. 2';
      }
    }

    function toggleTakeProfit(){
      const tp = document.getElementById('takeProfit');
      const toggle = document.getElementById('tpToggle');
      tp.disabled = !toggle.checked;
      if(!toggle.checked){
        tp.value = '';
      }
    }

    function eraseAll(){
      document.querySelectorAll('input').forEach(i=>{
        if(i.type !== 'checkbox') i.value='';
        if(i.id==='takeProfit') i.disabled=true;
        if(i.id==='tpToggle') i.checked=false;
      });
      document.getElementById('out').innerText='Enter values and press Calculate';
    }

    function formatNumber(num, decimals = 2) {
      if(isNaN(num)) return '-';
      return num.toLocaleString('en-US', {minimumFractionDigits: decimals, maximumFractionDigits: decimals});
    }

    function parseNumber(val){
      return parseFloat(val);
    }

    function calc(){
      const riskType = document.getElementById('riskType').value;
      const entry = parseNumber(document.getElementById('entry').value);
      const stop = parseNumber(document.getElementById('stop').value);
      const lev = parseNumber(document.getElementById('leverage').value);
      const tpToggle = document.getElementById('tpToggle').checked;
      const tpValue = parseNumber(document.getElementById('takeProfit').value);
      const out = document.getElementById('out');

      if(!entry || !stop || !lev){
        out.innerText = "‚ö†Ô∏è Please enter entry, stop, and leverage.";
        return;
      }

      let riskUsd = 0;
      if(riskType === 'percent'){
        const cap = parseNumber(document.getElementById('capital').value);
        const riskPct = parseNumber(document.getElementById('riskValue').value);
        if(!cap || !riskPct){out.innerText = "‚ö†Ô∏è Enter capital and risk %.";return;}
        riskUsd = cap * (riskPct / 100);
      } else {
        const riskVal = parseNumber(document.getElementById('riskValue').value);
        if(!riskVal){out.innerText = "‚ö†Ô∏è Enter fixed risk amount.";return;}
        riskUsd = riskVal;
      }

      const stopDist = Math.abs(entry - stop);
      if(stopDist === 0){out.innerText = "‚ö†Ô∏è Stop distance cannot be zero.";return;}

      const qty = riskUsd / stopDist;
      const notional = qty * entry;
      const margin = notional / lev;
      const stopPercent = (stopDist / entry) * 100;

      let result = `
        üßÆ <b>Stop Distance:</b> ${formatNumber(stopPercent, 3)}%<br>
        üí∞ <b>Risk Amount:</b> $${formatNumber(riskUsd)}<br>
        ‚öôÔ∏è <b>Quantity:</b> ${formatNumber(qty, 6)} units<br>
        üìà <b>Position Size:</b> $${formatNumber(notional)}<br>
        üíµ <b>Margin Required:</b> <b>$${formatNumber(margin)}</b><br>
        ‚öñÔ∏è <b>Leverage:</b> ${formatNumber(lev, 0)}x
      `;

      if(tpToggle){
        if(tpValue){
          const tpDist = Math.abs(tpValue - entry);
          const rr = tpDist / stopDist;
          const tpPercent = (tpDist / entry) * 100;
          const profitUsd = riskUsd * rr;
          result += `
            <br>üéØ <b>Take Profit:</b> $${formatNumber(tpValue)}<br>
            üìä <b>Reward Distance:</b> ${formatNumber(tpPercent, 3)}%<br>
            üíπ <b>Reward : Risk Ratio:</b> <b>${formatNumber(rr, 2)}R</b><br>
            üíµ <b>Profit if TP Hit:</b> <b>$${formatNumber(profitUsd)}</b>
          `;
        } else {
          result += `<br>üéØ <b>Take Profit not defined.</b>`;
        }
      }

      out.innerHTML = result;
    }
  </script>
</body>
</html>
