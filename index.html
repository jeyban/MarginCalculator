<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Crypto Scalp Margin Calculator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{
      font-family:Poppins,system-ui;
      background:#0b1220;
      color:#e6eef8;
      display:flex;
      align-items:center;
      justify-content:center;
      height:100vh;
      margin:0;
    }
    .card{
      background:#0f1724;
      padding:25px;
      border-radius:16px;
      width:340px;
      box-shadow:0 8px 30px rgba(0,0,0,0.6);
    }
    input,select{
      width:100%;
      padding:10px;
      margin:8px 0;
      border-radius:8px;
      border:1px solid #263044;
      background:#061221;
      color:#e6eef8;
    }
    button{
      width:100%;
      padding:10px;
      border-radius:8px;
      border:none;
      background:#f97316;
      color:#071322;
      font-weight:700;
      margin-top:10px;
      transition:background .2s;
    }
    button:hover{background:#fb923c;}
    .out{
      margin-top:15px;
      padding:12px;
      border-radius:8px;
      background:#081426;
      color:#cfe9ff;
      font-size:14px;
      line-height:1.5em;
    }
    h3{text-align:center;margin-top:0;color:#f97316;}
    .bold{font-weight:700;color:#f97316;}

    /* --- Take-Profit Row Alignment --- */
    .tp-row{
      display:flex;
      align-items:center;
      gap:8px;
      margin-top:6px;
      width:100%;
      box-sizing:border-box;
    }
    .tp-row input[type="checkbox"]{
      flex:0 0 auto;
      margin:0;
      transform:scale(1.1);
      appearance:auto;
      -webkit-appearance:checkbox;
    }
    .tp-row label{
      margin:0;
      padding:0;
      color:#e6eef8;
      font-size:14px;
      flex:1 1 auto;
      text-align:left;
    }
  </style>
</head>
<body>
  <div class="card">
    <h3>Crypto Scalp Margin Calculator</h3>

    <label>Risk Type</label>
    <select id="riskType" onchange="toggleMode(); triggerCalc()">
      <option value="fixed">Fixed ($)</option>
      <option value="percent">% of Capital</option>
    </select>

    <div id="capitalWrapper" style="display:none">
      <label>Total Capital (USDT)</label>
      <input id="capital" type="number" step="any" placeholder="e.g. 100" oninput="triggerCalc()">
    </div>

    <label id="riskLabel">Risk ($)</label>
    <input id="riskValue" type="number" step="any" placeholder="e.g. 2" oninput="triggerCalc()">

    <label>Entry Price</label>
    <input id="entry" type="number" step="any" placeholder="e.g. 30000" oninput="triggerCalc()">

    <label>Stop Loss Price</label>
    <input id="stop" type="number" step="any" placeholder="e.g. 29990" oninput="triggerCalc()">

    <label>Leverage (x)</label>
    <input id="leverage" type="number" step="1" value="100" oninput="triggerCalc()">

    <!-- Take Profit Toggle -->
    <div class="tp-row">
      <input type="checkbox" id="tpToggle" onchange="toggleTakeProfit(); triggerCalc()">
      <label for="tpToggle">Enable Take Profit</label>
    </div>

    <div id="tpWrapper" style="display:none;">
      <label>Take Profit Price</label>
      <input id="tp" type="number" step="any" placeholder="e.g. 30100" oninput="triggerCalc()">
    </div>

    <button onclick="calc()">Calculate</button>
    <button onclick="eraseAll()">Erase All</button>

    <div class="out" id="out">Enter values and press Calculate</div>
  </div>

<script>
function toggleMode(){
  const riskType=document.getElementById('riskType').value;
  const capWrapper=document.getElementById('capitalWrapper');
  const riskLabel=document.getElementById('riskLabel');
  const riskInput=document.getElementById('riskValue');
  if(riskType==='percent'){
    capWrapper.style.display='block';
    riskLabel.innerText='Risk (%)';
    riskInput.placeholder='e.g. 1';
  }else{
    capWrapper.style.display='none';
    riskLabel.innerText='Risk ($)';
    riskInput.placeholder='e.g. 2';
  }
}

function formatNumber(num,decimals=2){
  return isNaN(num)?'-':num.toLocaleString('en-US',{minimumFractionDigits:decimals,maximumFractionDigits:decimals});
}

function toggleTakeProfit(){
  const tpEnabled=document.getElementById('tpToggle').checked;
  const tpWrapper=document.getElementById('tpWrapper');
  tpWrapper.style.display=tpEnabled?'block':'none';
}

function eraseAll(){
  document.querySelectorAll('input').forEach(i=>{
    if(i.type==='checkbox'){i.checked=false;}
    else{i.value='';}
  });
  document.getElementById('tpWrapper').style.display='none';
  document.getElementById('out').innerText='Enter values and press Calculate';
}

function triggerCalc(){setTimeout(calc,100);}

function calc(){
  const riskType=document.getElementById('riskType').value;
  const entry=parseFloat(document.getElementById('entry').value);
  const stop=parseFloat(document.getElementById('stop').value);
  const lev=parseFloat(document.getElementById('leverage').value);
  const out=document.getElementById('out');
  if(!entry||!stop||!lev){out.innerText="‚ö†Ô∏è Please enter entry, stop, and leverage.";return;}

  let riskUsd=0;
  if(riskType==='percent'){
    const cap=parseFloat(document.getElementById('capital').value);
    const riskPct=parseFloat(document.getElementById('riskValue').value);
    if(!cap||!riskPct){out.innerText="‚ö†Ô∏è Enter capital and risk %.";return;}
    riskUsd=cap*(riskPct/100);
  }else{
    const riskVal=parseFloat(document.getElementById('riskValue').value);
    if(!riskVal){out.innerText="‚ö†Ô∏è Enter fixed risk amount.";return;}
    riskUsd=riskVal;
  }

  const stopDist=Math.abs(entry-stop);
  if(stopDist===0){out.innerText="‚ö†Ô∏è Stop distance cannot be zero.";return;}

  const qty=riskUsd/stopDist;
  const notional=qty*entry;
  const margin=notional/lev;
  const stopPercent=(stopDist/entry)*100;

  const tpEnabled=document.getElementById('tpToggle').checked;
  let profitText="üéØ Take Profit not defined";

  if(tpEnabled){
    const tp=parseFloat(document.getElementById('tp').value);
    if(tp){
      const rr=(Math.abs(tp-entry)/stopDist);
      const profit=riskUsd*rr;
      profitText=`üí∞ <b class="bold">Profit:</b> $${formatNumber(profit)} (${formatNumber(rr,2)}R)`;
    }
  }

  out.innerHTML=`
    üßÆ <b>Stop Distance:</b> ${formatNumber(stopPercent,3)}%<br>
    üí∞ <b>Risk Amount:</b> $${formatNumber(riskUsd)}<br>
    ‚öôÔ∏è <b>Quantity:</b> ${formatNumber(qty,6)} units<br>
    üìà <b>Position Size:</b> $${formatNumber(notional)}<br>
    üíµ <b class="bold">Margin Required:</b> $${formatNumber(margin)}<br>
    ‚öñÔ∏è <b>Leverage:</b> ${formatNumber(lev,0)}x<br>
    ${profitText}
  `;
}
</script>
</body>
</html>
